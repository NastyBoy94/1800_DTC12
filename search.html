<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles/search.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <title>SmartShopper - Search</title>

    <!-- Firebase CDN -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous">
    </script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>

    <script src="./scripts/firebaseAPI.js"></script>
    <script src="./scripts/writeLikes.js"></script>
    <script src="./scripts/searchinput.js"></script>
</head>
<body>
    <nav role="navigation" class="navbar">
        <div id="menuToggle">
            <!--
             hidden checkbox is used as click reciever,
              so you can use the :checked selector on it.
              -->
            <input type="checkbox" />
    
            <!--
             spans to act as a hamburger.
              -->
            <span></span>
            <span></span>
            <span></span>
    
            <ul id="menu">
                <div class="menu-settings">
                    <a href="#"><li>Home</li></a>
                    <a href="#"><li>Setting</li></a>
                    <a href="/profile_page2.html"><li>Account</li></a>
                    <a href="/checkout.html"><li>Cart</li></a>
                </div>
                <br>
                <li style="color:black">Sort by:</li>
                <div class="sort-by"> <!-- sorts search results based on desired criteria-->
                    <a href="#" onclick="clearcards('Items-go-here'), filterCardsbyPrice('Items')"><li>Price</li></a>
                    <a href="#" onclick="clearcards('Items-go-here'), filterCardsbyReviews('Items')"><li>Review</li></a>
                    <a href="#" onclick="clearcards('Items-go-here'), filterCardsbyAvail('Items')"><li>Availability</li></a>
                </div>
            </ul>
        </div>
        <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
    
        <div class="wrapper">
            <br>
            <div class="label">SmartShopper</div>
            <div class="searchBar">
                <input id="searchQueryInput" type="text" name="searchQueryInput" placeholder="What are you looking for?" value="" />
                <button id="searchQuerySubmit" type="submit" name="searchQuerySubmit" onclick="displaySearch()">
                    <!-- ; onclick="searchinput(document.getElementById('searchQueryInput').value)" -->
                    <svg style="width:24px;height:24px" viewbox="0 0 24 24">
                        <path fill="#666666"
                            d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" />
                    </svg>
                </button>
                <i class="fa fa-heart fa_custom" onclick="window.location.href='/likes.html'"></i>
            </div>
        </div>
    </nav>
    <br><br><br><br><br>


    <!-- Templates for general use, not displayed -->
    <template id="CardTemplate">
        <div class="card py-2 mx-2" style="width: 18rem;">
            <img class="card-image card-img-top" src=" ..." alt="...">
            <div class="card-body">
                <i class="fa fa-heart fa_custom like-div" onclick="addLikesToUser(this.id)"></i>
                <h5 class="card-title">Card title</h5>
                <p class="card-text">Some quick example text to build on the card title and make up the bulk of the
                    card's content.</p>
                <p class="card-price">x</p>
                <p class="card-review">x</p>
<<<<<<< HEAD
                <!-- <a class="btn btn-primary card-href"></a> -->
=======
>>>>>>> 5c8bc7e66b66cceb991f4dd3e94516789d1b2b2c
            </div>
        </div>
    </template>

    <div class="container">
        <!-- Here is container for cards  -->
        <div class="container">
            <div id="Items-go-here" class="row row-cols-auto">

            </div>
        </div>
    </div>

    <script>
        //------------------------------------------------------------------
        // Read from firestore to get collection Items
        // Then for each item in the list,
        // create a new "card" from the "template"
        // update thet title and text, and other ID's
        // attach it to the gallery div
        //-------------------------------------------------------------------
        function clearcards(elementID) {
            document.getElementById(elementID).innerHTML = "";
        }

        // populate cards above with items and info from Firebase "Items" collection
        function displayCards(collection) {
            let CardTemplate = document.getElementById("CardTemplate");

            db.collection(collection).get()
                .then(snap => {
                    var i = 1;
                    snap.forEach(doc => {    //iterate thru each doc
                        var title = doc.data().name;
                        var details = doc.data().description;
                        var cost = doc.data().price;
                        var imgURL = doc.data().image;
                        var review = doc.data().ratings;
                        let newcard = CardTemplate.content.cloneNode(true);

                        //update title and text and image
                        newcard.querySelector('.card-title').innerHTML = title;
                        newcard.querySelector('.card-text').innerHTML = details;
                        newcard.querySelector('.card-price').innerHTML = "CAD $" + cost;
                        newcard.querySelector('.card-image').src = imgURL;  //hikes.jpg
                        newcard.querySelector('.card-review').innerHTML = "ratings:  " + review + "/5";

                        //give unique ids to all elements for future use
                        newcard.querySelector('.card-title').setAttribute("id", "ctitle" + i);
                        newcard.querySelector('.card-text').setAttribute("id", "ctext" + i);
                        newcard.querySelector('.card-image').setAttribute("id", "cimage" + i);
                        newcard.querySelector('.card-price').setAttribute("id", "cprice" + i);
                        newcard.querySelector('.card-review').setAttribute("id", "creview" + i);
                        newcard.querySelector('.fa').setAttribute("id", i);

                        //attach to gallery
                        document.getElementById(collection + "-go-here").appendChild(newcard);
                        i++;
                    })
                })
        }

        // filter items by price from lowest to highest
        function filterCardsbyPrice(collection) {
            let CardTemplate = document.getElementById("CardTemplate");

            db.collection(collection).where("price", ">", "0").orderBy("price").get()
                .then(snap => {
                    var i = 1;
                    snap.forEach(doc => {    //iterate thru each doc
                        var title = doc.data().name;
                        var details = doc.data().description;
                        var cost = doc.data().price;
                        var imgURL = doc.data().image;
                        var review = doc.data().ratings;
                        let newcard = CardTemplate.content.cloneNode(true);

                        //update title and text and image
                        newcard.querySelector('.card-title').innerHTML = title;
                        newcard.querySelector('.card-text').innerHTML = details;
                        newcard.querySelector('.card-price').innerHTML = "CAD $" + cost;
                        newcard.querySelector('.card-image').src = imgURL;  //hikes.jpg
                        newcard.querySelector('.card-review').innerHTML = "ratings:  " + review + "/5";

                        //give unique ids to all elements for future use
                        newcard.querySelector('.card-title').setAttribute("id", "ctitle" + i);
                        newcard.querySelector('.card-text').setAttribute("id", "ctext" + i);
                        newcard.querySelector('.card-image').setAttribute("id", "cimage" + i);
                        newcard.querySelector('.card-price').setAttribute("id", "cprice" + i);
                        newcard.querySelector('.card-review').setAttribute("id", "creview" + i);
                        newcard.querySelector('.fa').setAttribute("id", i);

                        //attach to gallery
                        document.getElementById(collection + "-go-here").appendChild(newcard);
                        i++;
                    })
                })
        }

        // filter items by availability and display only available items
        function filterCardsbyAvail(collection) {
            let CardTemplate = document.getElementById("CardTemplate");

            db.collection(collection).where("availability", "==", "yes").get()
                .then(snap => {
                    var i = 1;
                    snap.forEach(doc => {    //iterate thru each doc
                        var title = doc.data().name;
                        var details = doc.data().description;
                        var cost = doc.data().price;
                        var imgURL = doc.data().image;
                        var review = doc.data().ratings;
                        let newcard = CardTemplate.content.cloneNode(true);

                        //update title and text and image
                        newcard.querySelector('.card-title').innerHTML = title;
                        newcard.querySelector('.card-text').innerHTML = details;
                        newcard.querySelector('.card-price').innerHTML = "CAD $" + cost;
                        newcard.querySelector('.card-image').src = imgURL;  //hikes.jpg
                        newcard.querySelector('.card-review').innerHTML = "ratings:  " + review + "/5";

                        //give unique ids to all elements for future use
                        newcard.querySelector('.card-title').setAttribute("id", "ctitle" + i);
                        newcard.querySelector('.card-text').setAttribute("id", "ctext" + i);
                        newcard.querySelector('.card-image').setAttribute("id", "cimage" + i);
                        newcard.querySelector('.card-price').setAttribute("id", "cprice" + i);
                        newcard.querySelector('.card-review').setAttribute("id", "creview" + i);
                        newcard.querySelector('.fa').setAttribute("id", i);

                        //attach to gallery
                        document.getElementById(collection + "-go-here").appendChild(newcard);
                        i++;
                    })
                })
        }

        // filters items by reviews from high to low before populating cards
        function filterCardsbyReviews(collection) {
            let CardTemplate = document.getElementById("CardTemplate");

            db.collection(collection).orderBy("ratings", "desc").get()
                .then(snap => {
                    var i = 1;
                    snap.forEach(doc => {    //iterate thru each doc
                        var title = doc.data().name;
                        var details = doc.data().description;
                        var cost = doc.data().price;
                        var imgURL = doc.data().image;
                        var review = doc.data().ratings;
                        let newcard = CardTemplate.content.cloneNode(true);

                        //update title and text and image
                        newcard.querySelector('.card-title').innerHTML = title;
                        newcard.querySelector('.card-text').innerHTML = details;
                        newcard.querySelector('.card-price').innerHTML = "CAD $" + cost;
                        newcard.querySelector('.card-image').src = imgURL;  //hikes.jpg
                        newcard.querySelector('.card-review').innerHTML = "ratings:  " + review + "/5";

                        //give unique ids to all elements for future use
                        newcard.querySelector('.card-title').setAttribute("id", "ctitle" + i);
                        newcard.querySelector('.card-text').setAttribute("id", "ctext" + i);
                        newcard.querySelector('.card-image').setAttribute("id", "cimage" + i);
                        newcard.querySelector('.card-price').setAttribute("id", "cprice" + i);
                        newcard.querySelector('.card-review').setAttribute("id", "creview" + i);
                        newcard.querySelector('.fa').setAttribute("id", i);

                        //attach to gallery
                        document.getElementById(collection + "-go-here").appendChild(newcard);
                        i++;
                    })
                })
        }

        async function csvToConsole() {
            const response = await fetch('./data/apparel.csv');
            const data = await response.text();
            const list = data.split('\n').slice(1);
            list.forEach(row => {
                /* namely the customer ID, price, item name, and description */
                let re = /(([A-Z]|[a-z]|[0-9]|-|\s|\.|:|\/|\_|\@)*,{1}|("{1}[^"]*"{1}),{1})/;
                let columns = row.split(re);
                console.log(columns[5]);
                console.log(columns);
            });
        }

        async function addCSVData() {
            const response = await fetch('./data/apparel.csv');
            const data = await response.text();
            const list = data.split('\n').slice(1);
            list.forEach(row => {
                /* namely the customer ID, price, item name, and description */
                let re = /(([A-Z]|[a-z]|[0-9]|-|\s|\.|:|\/|\_|\@)*,{1}|("{1}[^"]*"{1}),{1})/;
                let columns = row.split(re);
                let image = columns[97];
                image = image.substring(0, image.length - 1);
                let name = columns[5];
                name = name.substring(0, name.length - 1);
                let description = columns[9]
                description = description.substring(0, description.length - 1);
                let price = columns[77]
                price = price.substring(0, price.length - 1);

                if (name !== "") {
                    db.collection("Items").add({
                        name: name,
                        description: description,
                        price: price,
                        image: image
                    });
                }
            });
        }

        displayCards("Items");

    </script>

</body>
</html>